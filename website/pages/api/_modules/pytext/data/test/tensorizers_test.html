
<script type="text/javascript" id="documentation_options" data-url_root="./"
  src="/js/documentation_options.js"></script>
<script type="text/javascript" src="/js/jquery.js"></script>
<script type="text/javascript" src="/js/underscore.js"></script>
<script type="text/javascript" src="/js/doctools.js"></script>
<script type="text/javascript" src="/js/language_data.js"></script>
<script type="text/javascript" src="/js/searchtools.js"></script>
<div class="sphinx"><div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<h1>Source code for pytext.data.test.tensorizers_test</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># Copyright (c) Facebook, Inc. and its affiliates. All Rights Reserved</span>

<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">pytext.data.bert_tensorizer</span> <span class="kn">import</span> <span class="n">BERTTensorizer</span><span class="p">,</span> <span class="n">BERTTensorizerScriptImpl</span>
<span class="kn">from</span> <span class="nn">pytext.data.roberta_tensorizer</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">RoBERTaTensorizer</span><span class="p">,</span>
    <span class="n">RoBERTaTensorizerScriptImpl</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pytext.data.sources</span> <span class="kn">import</span> <span class="n">SquadDataSource</span>
<span class="kn">from</span> <span class="nn">pytext.data.sources.data_source</span> <span class="kn">import</span> <span class="n">Gazetteer</span><span class="p">,</span> <span class="n">SafeFileWrapper</span><span class="p">,</span> <span class="n">load_float_list</span>
<span class="kn">from</span> <span class="nn">pytext.data.sources.tsv</span> <span class="kn">import</span> <span class="n">SessionTSVDataSource</span><span class="p">,</span> <span class="n">TSVDataSource</span>
<span class="kn">from</span> <span class="nn">pytext.data.squad_for_bert_tensorizer</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">SquadForBERTTensorizer</span><span class="p">,</span>
    <span class="n">SquadForRoBERTaTensorizer</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pytext.data.squad_tensorizer</span> <span class="kn">import</span> <span class="n">SquadTensorizer</span>
<span class="kn">from</span> <span class="nn">pytext.data.tensorizers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AnnotationNumberizer</span><span class="p">,</span>
    <span class="n">ByteTensorizer</span><span class="p">,</span>
    <span class="n">ByteTokenTensorizer</span><span class="p">,</span>
    <span class="n">FloatListTensorizer</span><span class="p">,</span>
    <span class="n">GazetteerTensorizer</span><span class="p">,</span>
    <span class="n">LabelListTensorizer</span><span class="p">,</span>
    <span class="n">LabelTensorizer</span><span class="p">,</span>
    <span class="n">SeqTokenTensorizer</span><span class="p">,</span>
    <span class="n">TokenTensorizer</span><span class="p">,</span>
    <span class="n">VocabConfig</span><span class="p">,</span>
    <span class="n">VocabFileConfig</span><span class="p">,</span>
    <span class="n">initialize_tensorizers</span><span class="p">,</span>
    <span class="n">lookup_tokens</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pytext.data.tokenizers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DoNothingTokenizer</span><span class="p">,</span>
    <span class="n">GPT2BPETokenizer</span><span class="p">,</span>
    <span class="n">Tokenizer</span><span class="p">,</span>
    <span class="n">WordPieceTokenizer</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pytext.data.utils</span> <span class="kn">import</span> <span class="n">BOS</span><span class="p">,</span> <span class="n">EOS</span><span class="p">,</span> <span class="n">Vocabulary</span>
<span class="kn">from</span> <span class="nn">pytext.utils.test</span> <span class="kn">import</span> <span class="n">import_tests_module</span>


<span class="n">tests_module</span> <span class="o">=</span> <span class="n">import_tests_module</span><span class="p">()</span>


<div class="viewcode-block" id="LookupTokensTest"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.LookupTokensTest">[docs]</a><span class="k">class</span> <span class="nc">LookupTokensTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="LookupTokensTest.test_lookup_tokens"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.LookupTokensTest.test_lookup_tokens">[docs]</a>    <span class="k">def</span> <span class="nf">test_lookup_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">"let's tokenize this"</span>
        <span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">()</span>
        <span class="n">vocab</span> <span class="o">=</span> <span class="n">Vocabulary</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="n">BOS</span><span class="p">,</span> <span class="n">EOS</span><span class="p">])</span>
        <span class="n">tokens</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">=</span> <span class="n">lookup_tokens</span><span class="p">(</span>
            <span class="n">text</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">vocab</span><span class="o">=</span><span class="n">vocab</span><span class="p">,</span> <span class="n">bos_token</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">eos_token</span><span class="o">=</span><span class="bp">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">end_idx</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">19</span><span class="p">))</span>

        <span class="n">tokens</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">=</span> <span class="n">lookup_tokens</span><span class="p">(</span>
            <span class="n">text</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">vocab</span><span class="o">=</span><span class="n">vocab</span><span class="p">,</span> <span class="n">bos_token</span><span class="o">=</span><span class="n">BOS</span><span class="p">,</span> <span class="n">eos_token</span><span class="o">=</span><span class="n">EOS</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">end_idx</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="ListTensorizersTest"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.ListTensorizersTest">[docs]</a><span class="k">class</span> <span class="nc">ListTensorizersTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="ListTensorizersTest.setUp"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.ListTensorizersTest.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">SessionTSVDataSource</span><span class="p">(</span>
            <span class="n">SafeFileWrapper</span><span class="p">(</span><span class="n">tests_module</span><span class="o">.</span><span class="n">test_file</span><span class="p">(</span><span class="s2">"seq_tagging_example.tsv"</span><span class="p">)),</span>
            <span class="n">field_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"session_id"</span><span class="p">,</span> <span class="s2">"intent"</span><span class="p">,</span> <span class="s2">"goal"</span><span class="p">,</span> <span class="s2">"label"</span><span class="p">],</span>
            <span class="n">schema</span><span class="o">=</span><span class="p">{</span><span class="s2">"intent"</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="s2">"goal"</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="s2">"label"</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]},</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ListTensorizersTest.test_initialize_list_tensorizers"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.ListTensorizersTest.test_initialize_list_tensorizers">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize_list_tensorizers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"intent"</span><span class="p">:</span> <span class="n">LabelListTensorizer</span><span class="p">(</span>
                <span class="n">label_column</span><span class="o">=</span><span class="s2">"intent"</span><span class="p">,</span> <span class="n">pad_in_vocab</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">allow_unknown</span><span class="o">=</span><span class="bp">True</span>
            <span class="p">),</span>
            <span class="s2">"goal"</span><span class="p">:</span> <span class="n">LabelListTensorizer</span><span class="p">(</span><span class="n">label_column</span><span class="o">=</span><span class="s2">"goal"</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">initialize_tensorizers</span><span class="p">(</span><span class="n">tensorizers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensorizers</span><span class="p">[</span><span class="s2">"intent"</span><span class="p">]</span><span class="o">.</span><span class="n">vocab</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensorizers</span><span class="p">[</span><span class="s2">"goal"</span><span class="p">]</span><span class="o">.</span><span class="n">vocab</span><span class="p">))</span></div>

<div class="viewcode-block" id="ListTensorizersTest.test_create_label_list_tensors"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.ListTensorizersTest.test_create_label_list_tensors">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_label_list_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"intent"</span><span class="p">:</span> <span class="n">LabelListTensorizer</span><span class="p">(</span>
                <span class="n">label_column</span><span class="o">=</span><span class="s2">"intent"</span><span class="p">,</span> <span class="n">pad_in_vocab</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">allow_unknown</span><span class="o">=</span><span class="bp">True</span>
            <span class="p">)</span>
        <span class="p">}</span>
        <span class="n">initialize_tensorizers</span><span class="p">(</span><span class="n">tensorizers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="p">)</span>
        <span class="n">tensors</span> <span class="o">=</span> <span class="p">[</span><span class="n">tensorizers</span><span class="p">[</span><span class="s2">"intent"</span><span class="p">]</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="p">]</span>
        <span class="c1"># test label idx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">tensors</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">tensors</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">tensors</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># test seq lens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">tensors</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">tensors</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">tensors</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensors</span><span class="p">))</span>
        <span class="n">tensors</span><span class="p">,</span> <span class="n">lens</span> <span class="o">=</span> <span class="n">tensorizers</span><span class="p">[</span><span class="s2">"intent"</span><span class="p">]</span><span class="o">.</span><span class="n">tensorize</span><span class="p">(</span><span class="n">tensors</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_almost_equal</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]]),</span> <span class="n">tensors</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_almost_equal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="n">lens</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span></div>

<div class="viewcode-block" id="ListTensorizersTest.test_label_list_tensors_no_pad_in_vocab"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.ListTensorizersTest.test_label_list_tensors_no_pad_in_vocab">[docs]</a>    <span class="k">def</span> <span class="nf">test_label_list_tensors_no_pad_in_vocab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"intent"</span><span class="p">:</span> <span class="n">LabelListTensorizer</span><span class="p">(</span>
                <span class="n">label_column</span><span class="o">=</span><span class="s2">"intent"</span><span class="p">,</span> <span class="n">pad_in_vocab</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">allow_unknown</span><span class="o">=</span><span class="bp">True</span>
            <span class="p">)</span>
        <span class="p">}</span>
        <span class="n">initialize_tensorizers</span><span class="p">(</span><span class="n">tensorizers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensorizers</span><span class="p">[</span><span class="s2">"intent"</span><span class="p">]</span><span class="o">.</span><span class="n">vocab</span><span class="p">))</span>
        <span class="n">tensors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="p">:</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">"intent"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"unknown"</span><span class="p">)</span>
            <span class="n">tensors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tensorizers</span><span class="p">[</span><span class="s2">"intent"</span><span class="p">]</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
        <span class="n">tensors</span><span class="p">,</span> <span class="n">lens</span> <span class="o">=</span> <span class="n">tensorizers</span><span class="p">[</span><span class="s2">"intent"</span><span class="p">]</span><span class="o">.</span><span class="n">tensorize</span><span class="p">(</span><span class="n">tensors</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_almost_equal</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]),</span>
            <span class="n">tensors</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
        <span class="p">)</span></div></div>


<span class="c1"># fmt: off</span>
<span class="n">EXPECTED_ACTIONS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="p">]</span>
<span class="c1"># fmt: on</span>


<div class="viewcode-block" id="TensorizersTest"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest">[docs]</a><span class="k">class</span> <span class="nc">TensorizersTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TensorizersTest.setUp"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">TSVDataSource</span><span class="p">(</span>
            <span class="n">SafeFileWrapper</span><span class="p">(</span><span class="n">tests_module</span><span class="o">.</span><span class="n">test_file</span><span class="p">(</span><span class="s2">"train_dense_features_tiny.tsv"</span><span class="p">)),</span>
            <span class="n">SafeFileWrapper</span><span class="p">(</span><span class="n">tests_module</span><span class="o">.</span><span class="n">test_file</span><span class="p">(</span><span class="s2">"test_dense_features_tiny.tsv"</span><span class="p">)),</span>
            <span class="n">eval_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">field_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"label"</span><span class="p">,</span> <span class="s2">"slots"</span><span class="p">,</span> <span class="s2">"text"</span><span class="p">,</span> <span class="s2">"dense"</span><span class="p">],</span>
            <span class="n">schema</span><span class="o">=</span><span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">"label"</span><span class="p">:</span> <span class="nb">str</span><span class="p">},</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_initialize_tensorizer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tensorizer</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">init</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="n">init</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>  <span class="c1"># kick</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="p">:</span>
            <span class="n">init</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="n">init</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="TensorizersTest.test_initialize_tensorizers"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_initialize_tensorizers">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize_tensorizers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"tokens"</span><span class="p">:</span> <span class="n">TokenTensorizer</span><span class="p">(</span><span class="n">text_column</span><span class="o">=</span><span class="s2">"text"</span><span class="p">),</span>
            <span class="s2">"labels"</span><span class="p">:</span> <span class="n">LabelTensorizer</span><span class="p">(</span><span class="n">label_column</span><span class="o">=</span><span class="s2">"label"</span><span class="p">),</span>
            <span class="s2">"chars"</span><span class="p">:</span> <span class="n">ByteTensorizer</span><span class="p">(</span><span class="n">text_column</span><span class="o">=</span><span class="s2">"text"</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">initialize_tensorizers</span><span class="p">(</span><span class="n">tensorizers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensorizers</span><span class="p">[</span><span class="s2">"tokens"</span><span class="p">]</span><span class="o">.</span><span class="n">vocab</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensorizers</span><span class="p">[</span><span class="s2">"labels"</span><span class="p">]</span><span class="o">.</span><span class="n">vocab</span><span class="p">))</span></div>

<div class="viewcode-block" id="TensorizersTest.test_initialize_token_tensorizer"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_initialize_token_tensorizer">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize_token_tensorizer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># default (build from data)</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">TokenTensorizer</span><span class="p">(</span><span class="n">text_column</span><span class="o">=</span><span class="s2">"text"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_tensorizer</span><span class="p">(</span><span class="n">tensorizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">vocab</span><span class="p">))</span>

        <span class="c1"># size limit on tokens from data</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">TokenTensorizer</span><span class="p">(</span>
            <span class="n">text_column</span><span class="o">=</span><span class="s2">"text"</span><span class="p">,</span> <span class="n">vocab_config</span><span class="o">=</span><span class="n">VocabConfig</span><span class="p">(</span><span class="n">size_from_data</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_tensorizer</span><span class="p">(</span><span class="n">tensorizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">vocab</span><span class="p">))</span>  <span class="c1"># 3 + unk token + pad token</span>

        <span class="n">embed_file</span> <span class="o">=</span> <span class="n">tests_module</span><span class="o">.</span><span class="n">test_file</span><span class="p">(</span><span class="s2">"pretrained_embed_raw"</span><span class="p">)</span>

        <span class="c1"># vocab from data + vocab_file</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">TokenTensorizer</span><span class="p">(</span>
            <span class="n">text_column</span><span class="o">=</span><span class="s2">"text"</span><span class="p">,</span>
            <span class="n">vocab_config</span><span class="o">=</span><span class="n">VocabConfig</span><span class="p">(</span>
                <span class="n">size_from_data</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                <span class="n">vocab_files</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">VocabFileConfig</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">embed_file</span><span class="p">,</span> <span class="n">skip_header_line</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="p">],</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_tensorizer</span><span class="p">(</span><span class="n">tensorizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">vocab</span><span class="p">))</span>

        <span class="c1"># vocab just from vocab_file</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">TokenTensorizer</span><span class="p">(</span>
            <span class="n">text_column</span><span class="o">=</span><span class="s2">"text"</span><span class="p">,</span>
            <span class="n">vocab_config</span><span class="o">=</span><span class="n">VocabConfig</span><span class="p">(</span>
                <span class="n">build_from_data</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">vocab_files</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">VocabFileConfig</span><span class="p">(</span>
                        <span class="n">filepath</span><span class="o">=</span><span class="n">embed_file</span><span class="p">,</span> <span class="n">skip_header_line</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">size_limit</span><span class="o">=</span><span class="mi">5</span>
                    <span class="p">)</span>
                <span class="p">],</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">init</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="c1"># Should skip initialization</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">StopIteration</span><span class="p">):</span>
            <span class="n">init</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">vocab</span><span class="p">))</span>  <span class="c1"># 5 + unk token + pad token</span></div>

<div class="viewcode-block" id="TensorizersTest.test_create_word_tensors"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_create_word_tensors">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_word_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">TokenTensorizer</span><span class="p">(</span><span class="n">text_column</span><span class="o">=</span><span class="s2">"text"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_tensorizer</span><span class="p">(</span><span class="n">tensorizer</span><span class="p">)</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">"text"</span><span class="p">:</span> <span class="s2">"I want some coffee"</span><span class="p">},</span> <span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="s2">"Turn it up"</span><span class="p">}]</span>
        <span class="n">tensors</span> <span class="o">=</span> <span class="p">(</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">)</span>
        <span class="n">tokens</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">,</span> <span class="n">token_ranges</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">tensors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">tokens</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">18</span><span class="p">)],</span> <span class="n">token_ranges</span><span class="p">)</span>

        <span class="n">tokens</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">,</span> <span class="n">token_ranges</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">tensors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="mi">13</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="n">tokens</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">)],</span> <span class="n">token_ranges</span><span class="p">)</span></div>

<div class="viewcode-block" id="TensorizersTest.test_create_byte_tensors"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_create_byte_tensors">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_byte_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">ByteTensorizer</span><span class="p">(</span><span class="n">text_column</span><span class="o">=</span><span class="s2">"text"</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c1"># not initializing because initializing is a no-op for ByteTensorizer</span>

        <span class="n">s1</span> <span class="o">=</span> <span class="s2">"I want some coffee"</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="s2">"Turn it up"</span>
        <span class="n">s3</span> <span class="o">=</span> <span class="s2">"我不会说中文"</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">"text"</span><span class="p">:</span> <span class="n">s1</span><span class="p">},</span> <span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="n">s2</span><span class="p">},</span> <span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="n">s3</span><span class="p">}]</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="n">s2</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="n">s3</span><span class="o">.</span><span class="n">encode</span><span class="p">())]</span>

        <span class="n">tensors</span> <span class="o">=</span> <span class="p">[</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">bytes</span><span class="p">))</span> <span class="k">for</span> <span class="nb">bytes</span> <span class="ow">in</span> <span class="n">expected</span><span class="p">],</span> <span class="n">tensors</span><span class="p">)</span></div>

<div class="viewcode-block" id="TensorizersTest.test_byte_tensors_error_code"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_byte_tensors_error_code">[docs]</a>    <span class="k">def</span> <span class="nf">test_byte_tensors_error_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">ByteTensorizer</span><span class="p">(</span>
            <span class="n">text_column</span><span class="o">=</span><span class="s2">"text"</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">add_bos_token</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">add_eos_token</span><span class="o">=</span><span class="bp">True</span>
        <span class="p">)</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="s2">"I want some coffee#"</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="s2">"This is ^the best show I've ever seen"</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">"text"</span><span class="p">:</span> <span class="n">s1</span><span class="p">},</span> <span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="n">s2</span><span class="p">}]</span>
        <span class="n">expected_error_code</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SystemExit</span><span class="p">)</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="n">expected_error_code</span><span class="p">)</span></div>

<div class="viewcode-block" id="TensorizersTest.test_create_byte_token_tensors"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_create_byte_token_tensors">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_byte_token_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">ByteTokenTensorizer</span><span class="p">(</span>
            <span class="n">text_column</span><span class="o">=</span><span class="s2">"text"</span><span class="p">,</span> <span class="n">max_seq_len</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_byte_len</span><span class="o">=</span><span class="mi">5</span>
        <span class="p">)</span>
        <span class="c1"># not initializing because initializing is a no-op for this tensorizer</span>

        <span class="n">s1</span> <span class="o">=</span> <span class="s2">"I want some coffee today"</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="s2">"Turn it up"</span>

        <span class="k">def</span> <span class="nf">ords</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">pad_to</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">pad_to</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>

        <span class="n">batch</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">"text"</span><span class="p">:</span> <span class="n">s1</span><span class="p">},</span> <span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="n">s2</span><span class="p">}]</span>
        <span class="c1"># Note that the tokenizer lowercases here</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">ords</span><span class="p">(</span><span class="s2">"i"</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ords</span><span class="p">(</span><span class="s2">"want"</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ords</span><span class="p">(</span><span class="s2">"some"</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ords</span><span class="p">(</span><span class="s2">"coffe"</span><span class="p">,</span> <span class="mi">5</span><span class="p">)],</span>
            <span class="p">[</span><span class="n">ords</span><span class="p">(</span><span class="s2">"turn"</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ords</span><span class="p">(</span><span class="s2">"it"</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ords</span><span class="p">(</span><span class="s2">"up"</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ords</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="mi">5</span><span class="p">)],</span>
        <span class="p">]</span>
        <span class="n">expected_token_lens</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">expected_byte_lens</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>

        <span class="nb">bytes</span><span class="p">,</span> <span class="n">token_lens</span><span class="p">,</span> <span class="n">byte_lens</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">tensorize</span><span class="p">(</span>
            <span class="p">[</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">token_lens</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">byte_lens</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">2</span><span class="p">,),</span> <span class="n">token_lens</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">byte_lens</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_token_lens</span><span class="p">,</span> <span class="n">token_lens</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_byte_lens</span><span class="p">,</span> <span class="n">byte_lens</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span></div>

<div class="viewcode-block" id="TensorizersTest.test_initialize_label_tensorizer"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_initialize_label_tensorizer">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize_label_tensorizer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">LabelTensorizer</span><span class="p">(</span><span class="n">label_column</span><span class="o">=</span><span class="s2">"label"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_tensorizer</span><span class="p">(</span><span class="n">tensorizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">vocab</span><span class="p">))</span></div>

<div class="viewcode-block" id="TensorizersTest.test_create_label_tensors"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_create_label_tensors">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_label_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">LabelTensorizer</span><span class="p">(</span><span class="n">label_column</span><span class="o">=</span><span class="s2">"label"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_tensorizer</span><span class="p">(</span><span class="n">tensorizer</span><span class="p">)</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">"label"</span><span class="p">:</span> <span class="s2">"weather/find"</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">"label"</span><span class="p">:</span> <span class="s2">"alarm/set_alarm"</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">"label"</span><span class="p">:</span> <span class="s2">"non/existent"</span><span class="p">},</span>
        <span class="p">]</span>

        <span class="n">tensors</span> <span class="o">=</span> <span class="p">(</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">)</span>
        <span class="n">tensor</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">tensors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">tensor</span><span class="p">)</span>
        <span class="n">tensor</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">tensors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tensor</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="n">tensor</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">tensors</span><span class="p">)</span></div>

<div class="viewcode-block" id="TensorizersTest.test_gazetteer_tensor_bad_json"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_gazetteer_tensor_bad_json">[docs]</a>    <span class="k">def</span> <span class="nf">test_gazetteer_tensor_bad_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">GazetteerTensorizer</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">TSVDataSource</span><span class="p">(</span>
            <span class="n">train_file</span><span class="o">=</span><span class="n">SafeFileWrapper</span><span class="p">(</span>
                <span class="n">tests_module</span><span class="o">.</span><span class="n">test_file</span><span class="p">(</span><span class="s2">"train_dict_features_bad_json.tsv"</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">test_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">eval_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">field_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"text"</span><span class="p">,</span> <span class="s2">"dict"</span><span class="p">],</span>
            <span class="n">schema</span><span class="o">=</span><span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">"dict"</span><span class="p">:</span> <span class="n">Gazetteer</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="n">init</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="n">init</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>  <span class="c1"># kick</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="p">:</span>
                <span class="n">init</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="n">init</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="TensorizersTest.test_gazetteer_tensor"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_gazetteer_tensor">[docs]</a>    <span class="k">def</span> <span class="nf">test_gazetteer_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">GazetteerTensorizer</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">TSVDataSource</span><span class="p">(</span>
            <span class="n">train_file</span><span class="o">=</span><span class="n">SafeFileWrapper</span><span class="p">(</span>
                <span class="n">tests_module</span><span class="o">.</span><span class="n">test_file</span><span class="p">(</span><span class="s2">"train_dict_features.tsv"</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">test_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">eval_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">field_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"text"</span><span class="p">,</span> <span class="s2">"dict"</span><span class="p">],</span>
            <span class="n">schema</span><span class="o">=</span><span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">"dict"</span><span class="p">:</span> <span class="n">Gazetteer</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_tensorizer</span><span class="p">(</span><span class="n">tensorizer</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="c1"># UNK + PAD + 5 labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">vocab</span><span class="p">))</span>

        <span class="c1"># only two rows in test file:</span>
        <span class="c1"># "Order coffee from Starbucks please"</span>
        <span class="c1"># "Order some fries from McDonalds please"</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">idx</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">lens</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">idx</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">weights</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lens</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">idx</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">lens</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">idx</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">weights</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lens</span><span class="p">)</span>

        <span class="n">feats</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">lens</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">tensorize</span><span class="p">(</span>
            <span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">train</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">],</span>
            <span class="n">feats</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="nb">str</span><span class="p">(</span>
                <span class="p">[[</span><span class="nb">round</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">utt_weights</span><span class="p">]</span> <span class="k">for</span> <span class="n">utt_weights</span> <span class="ow">in</span> <span class="n">weights</span><span class="o">.</span><span class="n">numpy</span><span class="p">()]</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">lens</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="TensorizersTest.test_seq_tensor"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_seq_tensor">[docs]</a>    <span class="k">def</span> <span class="nf">test_seq_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">SeqTokenTensorizer</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">TSVDataSource</span><span class="p">(</span>
            <span class="n">train_file</span><span class="o">=</span><span class="n">SafeFileWrapper</span><span class="p">(</span>
                <span class="n">tests_module</span><span class="o">.</span><span class="n">test_file</span><span class="p">(</span><span class="s2">"train_seq_features.tsv"</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">test_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">eval_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">field_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"text_seq"</span><span class="p">],</span>
            <span class="n">schema</span><span class="o">=</span><span class="p">{</span><span class="s2">"text_seq"</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]},</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_tensorizer</span><span class="p">(</span><span class="n">tensorizer</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="c1"># UNK + PAD + 6 tokens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">vocab</span><span class="p">))</span>

        <span class="c1"># only one row in test file:</span>
        <span class="c1"># ["where do you wanna meet?", "MPK"]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="p">:</span>
            <span class="n">tokens</span><span class="p">,</span> <span class="n">token_lens</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">prepare_input</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">,</span> <span class="n">lens</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">lens</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">idx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">token_lens</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">[</span><span class="s2">"where"</span><span class="p">,</span> <span class="s2">"do"</span><span class="p">,</span> <span class="s2">"you"</span><span class="p">,</span> <span class="s2">"wanna"</span><span class="p">,</span> <span class="s2">"meet?"</span><span class="p">],</span>
                    <span class="p">[</span><span class="s2">"mpk"</span><span class="p">,</span> <span class="s2">"__PAD__"</span><span class="p">,</span> <span class="s2">"__PAD__"</span><span class="p">,</span> <span class="s2">"__PAD__"</span><span class="p">,</span> <span class="s2">"__PAD__"</span><span class="p">],</span>
                <span class="p">],</span>
                <span class="n">tokens</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="TensorizersTest.test_seq_tensor_with_bos_eos_eol_bol"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_seq_tensor_with_bos_eos_eol_bol">[docs]</a>    <span class="k">def</span> <span class="nf">test_seq_tensor_with_bos_eos_eol_bol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">SeqTokenTensorizer</span><span class="p">(</span>
            <span class="n">add_bos_token</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">add_eos_token</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">add_bol_token</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">add_eol_token</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">TSVDataSource</span><span class="p">(</span>
            <span class="n">train_file</span><span class="o">=</span><span class="n">SafeFileWrapper</span><span class="p">(</span>
                <span class="n">tests_module</span><span class="o">.</span><span class="n">test_file</span><span class="p">(</span><span class="s2">"train_seq_features.tsv"</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">test_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">eval_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">field_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"text_seq"</span><span class="p">],</span>
            <span class="n">schema</span><span class="o">=</span><span class="p">{</span><span class="s2">"text_seq"</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]},</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_tensorizer</span><span class="p">(</span><span class="n">tensorizer</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="c1"># UNK + PAD + BOS + EOS + BOL + EOL + 6 tokens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">vocab</span><span class="p">))</span>

        <span class="c1"># only one row in test file:</span>
        <span class="c1"># ["where do you wanna meet?", "MPK"]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="p">:</span>
            <span class="n">idx</span><span class="p">,</span> <span class="n">lens</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">tokens</span><span class="p">,</span> <span class="n">token_lens</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">prepare_input</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">lens</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">token_lens</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="p">],</span>
                <span class="n">idx</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">[</span>
                        <span class="s2">"__BEGIN_OF_SENTENCE__"</span><span class="p">,</span>
                        <span class="s2">"__BEGIN_OF_LIST__"</span><span class="p">,</span>
                        <span class="s2">"__END_OF_SENTENCE__"</span><span class="p">,</span>
                        <span class="s2">"__PAD__"</span><span class="p">,</span>
                        <span class="s2">"__PAD__"</span><span class="p">,</span>
                        <span class="s2">"__PAD__"</span><span class="p">,</span>
                        <span class="s2">"__PAD__"</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="p">[</span>
                        <span class="s2">"__BEGIN_OF_SENTENCE__"</span><span class="p">,</span>
                        <span class="s2">"where"</span><span class="p">,</span>
                        <span class="s2">"do"</span><span class="p">,</span>
                        <span class="s2">"you"</span><span class="p">,</span>
                        <span class="s2">"wanna"</span><span class="p">,</span>
                        <span class="s2">"meet?"</span><span class="p">,</span>
                        <span class="s2">"__END_OF_SENTENCE__"</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="p">[</span>
                        <span class="s2">"__BEGIN_OF_SENTENCE__"</span><span class="p">,</span>
                        <span class="s2">"mpk"</span><span class="p">,</span>
                        <span class="s2">"__END_OF_SENTENCE__"</span><span class="p">,</span>
                        <span class="s2">"__PAD__"</span><span class="p">,</span>
                        <span class="s2">"__PAD__"</span><span class="p">,</span>
                        <span class="s2">"__PAD__"</span><span class="p">,</span>
                        <span class="s2">"__PAD__"</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="p">[</span>
                        <span class="s2">"__BEGIN_OF_SENTENCE__"</span><span class="p">,</span>
                        <span class="s2">"__END_OF_LIST__"</span><span class="p">,</span>
                        <span class="s2">"__END_OF_SENTENCE__"</span><span class="p">,</span>
                        <span class="s2">"__PAD__"</span><span class="p">,</span>
                        <span class="s2">"__PAD__"</span><span class="p">,</span>
                        <span class="s2">"__PAD__"</span><span class="p">,</span>
                        <span class="s2">"__PAD__"</span><span class="p">,</span>
                    <span class="p">],</span>
                <span class="p">],</span>
                <span class="n">tokens</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="TensorizersTest.test_create_float_list_tensor"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_create_float_list_tensor">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_float_list_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">FloatListTensorizer</span><span class="p">(</span>
            <span class="n">column</span><span class="o">=</span><span class="s2">"dense"</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">error_check</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">False</span>
        <span class="p">)</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">"[0.1,0.2]"</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]),</span>  <span class="c1"># comma</span>
            <span class="p">(</span><span class="s2">"[0.1, 0.2]"</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]),</span>  <span class="c1"># comma with single space</span>
            <span class="p">(</span><span class="s2">"[0.1,  0.2]"</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]),</span>  <span class="c1"># comma with multiple spaces</span>
            <span class="p">(</span><span class="s2">"[0.1 0.2]"</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]),</span>  <span class="c1"># space</span>
            <span class="p">(</span><span class="s2">"[0.1  0.2]"</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]),</span>  <span class="c1"># multiple spaces</span>
            <span class="p">(</span><span class="s2">"[ 0.1  0.2]"</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]),</span>  <span class="c1"># space after [</span>
            <span class="p">(</span><span class="s2">"[0.1  0.2 ]"</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]),</span>  <span class="c1"># space before ]</span>
            <span class="p">(</span><span class="s2">"[0.  1.]"</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span>  <span class="c1"># 0., 1.</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">raw</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"dense"</span><span class="p">:</span> <span class="n">load_float_list</span><span class="p">(</span><span class="n">raw</span><span class="p">)}</span>
            <span class="n">numberized</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">numberized</span><span class="p">)</span></div>

<div class="viewcode-block" id="TensorizersTest.test_float_list_tensor_prepare_input"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_float_list_tensor_prepare_input">[docs]</a>    <span class="k">def</span> <span class="nf">test_float_list_tensor_prepare_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">FloatListTensorizer</span><span class="p">(</span>
            <span class="n">column</span><span class="o">=</span><span class="s2">"dense"</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">error_check</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">False</span>
        <span class="p">)</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">"[0.1,0.2]"</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])]</span>
        <span class="k">for</span> <span class="n">raw</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"dense"</span><span class="p">:</span> <span class="n">load_float_list</span><span class="p">(</span><span class="n">raw</span><span class="p">)}</span>
            <span class="n">numberized</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">prepare_input</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">numberized</span><span class="p">)</span></div>

<div class="viewcode-block" id="TensorizersTest.test_create_normalized_float_list_tensor"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_create_normalized_float_list_tensor">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_normalized_float_list_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">round_list</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s2">"</span><span class="si">%.4f</span><span class="s2">"</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">TSVDataSource</span><span class="p">(</span>
            <span class="n">SafeFileWrapper</span><span class="p">(</span><span class="n">tests_module</span><span class="o">.</span><span class="n">test_file</span><span class="p">(</span><span class="s2">"train_dense_features_tiny.tsv"</span><span class="p">)),</span>
            <span class="n">eval_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">field_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"label"</span><span class="p">,</span> <span class="s2">"slots"</span><span class="p">,</span> <span class="s2">"text"</span><span class="p">,</span> <span class="s2">"dense_feat"</span><span class="p">],</span>
            <span class="n">schema</span><span class="o">=</span><span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">"label"</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">"dense_feat"</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]},</span>
        <span class="p">)</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">FloatListTensorizer</span><span class="p">(</span>
            <span class="n">column</span><span class="o">=</span><span class="s2">"dense_feat"</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">error_check</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_tensorizer</span><span class="p">(</span><span class="n">tensorizer</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">num_rows</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">round_list</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="mf">7.56409</span><span class="p">,</span>
                    <span class="mf">8.2388</span><span class="p">,</span>
                    <span class="mf">0.5531</span><span class="p">,</span>
                    <span class="mf">0.2403</span><span class="p">,</span>
                    <span class="mf">1.03130</span><span class="p">,</span>
                    <span class="mf">6.2888</span><span class="p">,</span>
                    <span class="mf">3.1595</span><span class="p">,</span>
                    <span class="mf">0.1538</span><span class="p">,</span>
                    <span class="mf">0.2403</span><span class="p">,</span>
                    <span class="mf">5.3463</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="n">round_list</span><span class="p">(</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">feature_sums</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">round_list</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="mf">5.80172</span><span class="p">,</span>
                    <span class="mf">7.57586</span><span class="p">,</span>
                    <span class="mf">0.30591</span><span class="p">,</span>
                    <span class="mf">0.05774</span><span class="p">,</span>
                    <span class="mf">0.52762</span><span class="p">,</span>
                    <span class="mf">5.22811</span><span class="p">,</span>
                    <span class="mf">2.51727</span><span class="p">,</span>
                    <span class="mf">0.02365</span><span class="p">,</span>
                    <span class="mf">0.05774</span><span class="p">,</span>
                    <span class="mf">4.48798</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="n">round_list</span><span class="p">(</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">feature_squared_sums</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">round_list</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="mf">0.75640</span><span class="p">,</span>
                    <span class="mf">0.82388</span><span class="p">,</span>
                    <span class="mf">0.05531</span><span class="p">,</span>
                    <span class="mf">0.02403</span><span class="p">,</span>
                    <span class="mf">0.10313</span><span class="p">,</span>
                    <span class="mf">0.62888</span><span class="p">,</span>
                    <span class="mf">0.31595</span><span class="p">,</span>
                    <span class="mf">0.01538</span><span class="p">,</span>
                    <span class="mf">0.02403</span><span class="p">,</span>
                    <span class="mf">0.53463</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="n">round_list</span><span class="p">(</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">feature_avgs</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">round_list</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="mf">0.08953</span><span class="p">,</span>
                    <span class="mf">0.28072</span><span class="p">,</span>
                    <span class="mf">0.16593</span><span class="p">,</span>
                    <span class="mf">0.07209</span><span class="p">,</span>
                    <span class="mf">0.20524</span><span class="p">,</span>
                    <span class="mf">0.35682</span><span class="p">,</span>
                    <span class="mf">0.38974</span><span class="p">,</span>
                    <span class="mf">0.04614</span><span class="p">,</span>
                    <span class="mf">0.07209</span><span class="p">,</span>
                    <span class="mf">0.40369</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="n">round_list</span><span class="p">(</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">feature_stddevs</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.64840776</span><span class="p">,</span> <span class="mf">0.7575</span><span class="p">,</span> <span class="mf">0.5531</span><span class="p">,</span> <span class="mf">0.2403</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.9481</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.1538</span><span class="p">,</span> <span class="mf">0.2403</span><span class="p">,</span> <span class="mf">0.3564</span><span class="p">]</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">({</span><span class="s2">"dense_feat"</span><span class="p">:</span> <span class="n">row</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">round_list</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="o">-</span><span class="mf">1.20619</span><span class="p">,</span>
                    <span class="o">-</span><span class="mf">0.23646</span><span class="p">,</span>
                    <span class="mf">2.99999</span><span class="p">,</span>
                    <span class="mf">3.0</span><span class="p">,</span>
                    <span class="o">-</span><span class="mf">0.50246</span><span class="p">,</span>
                    <span class="mf">0.89462</span><span class="p">,</span>
                    <span class="o">-</span><span class="mf">0.81066</span><span class="p">,</span>
                    <span class="mf">2.99999</span><span class="p">,</span>
                    <span class="mf">3.0</span><span class="p">,</span>
                    <span class="o">-</span><span class="mf">0.44149</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="n">round_list</span><span class="p">(</span><span class="n">output</span><span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="TensorizersTest.test_annotation_num"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.TensorizersTest.test_annotation_num">[docs]</a>    <span class="k">def</span> <span class="nf">test_annotation_num</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">TSVDataSource</span><span class="p">(</span>
            <span class="n">SafeFileWrapper</span><span class="p">(</span><span class="n">tests_module</span><span class="o">.</span><span class="n">test_file</span><span class="p">(</span><span class="s2">"compositional_seq2seq_unit.tsv"</span><span class="p">)),</span>
            <span class="n">test_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">eval_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">field_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"text"</span><span class="p">,</span> <span class="s2">"seqlogical"</span><span class="p">],</span>
            <span class="n">schema</span><span class="o">=</span><span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">"seqlogical"</span><span class="p">:</span> <span class="nb">str</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">nbrz</span> <span class="o">=</span> <span class="n">AnnotationNumberizer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_tensorizer</span><span class="p">(</span><span class="n">nbrz</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="c1"># vocab = {'IN:GET_INFO_TRAFFIC': 0, 'SHIFT': 1, 'SL:LOCATION': 2,</span>
        <span class="c1"># 'REDUCE': 3, 'IN:GET_DIRECTIONS': 4, 'SL:DESTINATION': 5, 'SL:SOURCE': 6,</span>
        <span class="c1"># 'IN:GET_LOCATION_HOME': 7, 'SL:CONTACT': 8, 'SL:DATE_TIME_DEPARTURE': 9,</span>
        <span class="c1"># 'IN:UNSUPPORTED_NAVIGATION': 10, 'IN:GET_ESTIMATED_DURATION': 11,</span>
        <span class="c1"># 'IN:GET_LOCATION_WORK': 12, 'SL:PATH_AVOID': 13, 'IN:GET_DISTANCE': 14}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nbrz</span><span class="o">.</span><span class="n">vocab</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbrz</span><span class="o">.</span><span class="n">shift_idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">nbrz</span><span class="o">.</span><span class="n">reduce_idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="mi">10</span><span class="p">],</span> <span class="n">nbrz</span><span class="o">.</span><span class="n">ignore_subNTs_roots</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span> <span class="n">nbrz</span><span class="o">.</span><span class="n">valid_NT_idxs</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span> <span class="n">nbrz</span><span class="o">.</span><span class="n">valid_IN_idxs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span> <span class="n">nbrz</span><span class="o">.</span><span class="n">valid_SL_idxs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">EXPECTED_ACTIONS</span><span class="p">):</span>
            <span class="n">actions</span> <span class="o">=</span> <span class="n">nbrz</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actions</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="BERTTensorizerTest"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.BERTTensorizerTest">[docs]</a><span class="k">class</span> <span class="nc">BERTTensorizerTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="BERTTensorizerTest.test_bert_tensorizer"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.BERTTensorizerTest.test_bert_tensorizer">[docs]</a>    <span class="k">def</span> <span class="nf">test_bert_tensorizer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="s2">"&lt;SOS&gt;  Focus Driving School Mulungushi bus station along Kasuba road, wamkopeka building.  Ndola,  Zambia."</span>
        <span class="c1"># expected result was obtained offline by running BertModelDataHandler</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mi">101</span><span class="p">,</span>
            <span class="mi">133</span><span class="p">,</span>
            <span class="mi">278</span><span class="p">,</span>
            <span class="mi">217</span><span class="p">,</span>
            <span class="mi">135</span><span class="p">,</span>
            <span class="mi">175</span><span class="p">,</span>
            <span class="mi">287</span><span class="p">,</span>
            <span class="mi">766</span><span class="p">,</span>
            <span class="mi">462</span><span class="p">,</span>
            <span class="mi">100</span><span class="p">,</span>
            <span class="mi">379</span><span class="p">,</span>
            <span class="mi">182</span><span class="p">,</span>
            <span class="mi">459</span><span class="p">,</span>
            <span class="mi">334</span><span class="p">,</span>
            <span class="mi">459</span><span class="p">,</span>
            <span class="mi">280</span><span class="p">,</span>
            <span class="mi">504</span><span class="p">,</span>
            <span class="mi">462</span><span class="p">,</span>
            <span class="mi">425</span><span class="p">,</span>
            <span class="mi">283</span><span class="p">,</span>
            <span class="mi">171</span><span class="p">,</span>
            <span class="mi">462</span><span class="p">,</span>
            <span class="mi">567</span><span class="p">,</span>
            <span class="mi">474</span><span class="p">,</span>
            <span class="mi">180</span><span class="p">,</span>
            <span class="mi">262</span><span class="p">,</span>
            <span class="mi">217</span><span class="p">,</span>
            <span class="mi">459</span><span class="p">,</span>
            <span class="mi">931</span><span class="p">,</span>
            <span class="mi">262</span><span class="p">,</span>
            <span class="mi">913</span><span class="p">,</span>
            <span class="mi">117</span><span class="p">,</span>
            <span class="mi">192</span><span class="p">,</span>
            <span class="mi">262</span><span class="p">,</span>
            <span class="mi">407</span><span class="p">,</span>
            <span class="mi">478</span><span class="p">,</span>
            <span class="mi">287</span><span class="p">,</span>
            <span class="mi">744</span><span class="p">,</span>
            <span class="mi">263</span><span class="p">,</span>
            <span class="mi">478</span><span class="p">,</span>
            <span class="mi">262</span><span class="p">,</span>
            <span class="mi">560</span><span class="p">,</span>
            <span class="mi">119</span><span class="p">,</span>
            <span class="mi">183</span><span class="p">,</span>
            <span class="mi">282</span><span class="p">,</span>
            <span class="mi">287</span><span class="p">,</span>
            <span class="mi">843</span><span class="p">,</span>
            <span class="mi">117</span><span class="p">,</span>
            <span class="mi">195</span><span class="p">,</span>
            <span class="mi">262</span><span class="p">,</span>
            <span class="mi">407</span><span class="p">,</span>
            <span class="mi">931</span><span class="p">,</span>
            <span class="mi">566</span><span class="p">,</span>
            <span class="mi">119</span><span class="p">,</span>
            <span class="mi">102</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="n">sentence</span><span class="p">}</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">BERTTensorizer</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
            <span class="n">BERTTensorizer</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                <span class="n">tokenizer</span><span class="o">=</span><span class="n">WordPieceTokenizer</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                    <span class="n">wordpiece_vocab_path</span><span class="o">=</span><span class="s2">"pytext/data/test/data/wordpiece_1k.txt"</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">tensorizer_impl</span> <span class="o">=</span> <span class="n">BERTTensorizerScriptImpl</span><span class="p">(</span>
            <span class="n">tokenizer</span><span class="o">=</span><span class="n">DoNothingTokenizer</span><span class="p">(),</span>
            <span class="n">vocab</span><span class="o">=</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span>
            <span class="n">max_seq_len</span><span class="o">=</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">max_seq_len</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">torchscriptify</span><span class="p">()</span>

        <span class="n">tokens</span><span class="p">,</span> <span class="n">segment_label</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">,</span> <span class="n">positions</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">seq_len</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">segment_label</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>

        <span class="n">tokens</span><span class="p">,</span> <span class="n">pad_mask</span><span class="p">,</span> <span class="n">segment_labels</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">tensorize</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">segment_label</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">,</span> <span class="n">positions</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pad_mask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>

        <span class="n">per_sentence_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">sentence</span><span class="p">)]</span>
        <span class="n">tokens</span><span class="p">,</span> <span class="n">segment_label</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">,</span> <span class="n">positions</span> <span class="o">=</span> <span class="n">tensorizer_impl</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span>
            <span class="n">per_sentence_tokens</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">seq_len</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">segment_label</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>

        <span class="n">tokens</span><span class="p">,</span> <span class="n">pad_mask</span><span class="p">,</span> <span class="n">segment_labels</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">tensorizer_impl</span><span class="o">.</span><span class="n">tensorize</span><span class="p">(</span>
            <span class="p">[</span><span class="n">tokens</span><span class="p">],</span> <span class="p">[</span><span class="n">segment_label</span><span class="p">],</span> <span class="p">[</span><span class="n">seq_len</span><span class="p">],</span> <span class="p">[</span><span class="n">positions</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pad_mask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span></div>

<div class="viewcode-block" id="BERTTensorizerTest.test_bert_pair_tensorizer"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.BERTTensorizerTest.test_bert_pair_tensorizer">[docs]</a>    <span class="k">def</span> <span class="nf">test_bert_pair_tensorizer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Focus"</span><span class="p">,</span> <span class="s2">"Driving School"</span><span class="p">]</span>
        <span class="n">expected_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">287</span><span class="p">,</span> <span class="mi">766</span><span class="p">,</span> <span class="mi">462</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">379</span><span class="p">,</span> <span class="mi">102</span><span class="p">]</span>
        <span class="n">expected_segment_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"text1"</span><span class="p">:</span> <span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">"text2"</span><span class="p">:</span> <span class="n">sentences</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">BERTTensorizer</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
            <span class="n">BERTTensorizer</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"text1"</span><span class="p">,</span> <span class="s2">"text2"</span><span class="p">],</span>
                <span class="n">tokenizer</span><span class="o">=</span><span class="n">WordPieceTokenizer</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                    <span class="n">wordpiece_vocab_path</span><span class="o">=</span><span class="s2">"pytext/data/test/data/wordpiece_1k.txt"</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">tokens</span><span class="p">,</span> <span class="n">segment_labels</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">expected_tokens</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">segment_labels</span><span class="p">,</span> <span class="n">expected_segment_labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">seq_len</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected_tokens</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="RobertaTensorizerTest"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.RobertaTensorizerTest">[docs]</a><span class="k">class</span> <span class="nc">RobertaTensorizerTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="RobertaTensorizerTest.test_roberta_tensorizer"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.RobertaTensorizerTest.test_roberta_tensorizer">[docs]</a>    <span class="k">def</span> <span class="nf">test_roberta_tensorizer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">"Prototype"</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
        <span class="n">pad_masks</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="n">segment_labels</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="n">tokens</span><span class="p">,</span> <span class="n">pad_masks</span><span class="p">,</span> <span class="n">segment_labels</span><span class="p">,</span> <span class="n">positions</span><span class="p">]</span>

        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">RoBERTaTensorizer</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
            <span class="n">RoBERTaTensorizer</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                <span class="n">tokenizer</span><span class="o">=</span><span class="n">GPT2BPETokenizer</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                    <span class="n">bpe_encoder_path</span><span class="o">=</span><span class="s2">"pytext/data/test/data/gpt2_encoder.json"</span><span class="p">,</span>
                    <span class="n">bpe_vocab_path</span><span class="o">=</span><span class="s2">"pytext/data/test/data/gpt2_vocab.bpe"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">vocab_file</span><span class="o">=</span><span class="s2">"pytext/data/test/data/gpt2_dict.txt"</span><span class="p">,</span>
                <span class="n">max_seq_len</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">tensors</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">tensorize</span><span class="p">([</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">({</span><span class="s2">"text"</span><span class="p">:</span> <span class="n">text</span><span class="p">})])</span>
        <span class="k">for</span> <span class="n">tensor</span><span class="p">,</span> <span class="n">expect</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tensors</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tensor</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">expect</span><span class="p">)</span>

        <span class="n">tensorizer_impl</span> <span class="o">=</span> <span class="n">RoBERTaTensorizerScriptImpl</span><span class="p">(</span>
            <span class="n">tokenizer</span><span class="o">=</span><span class="n">DoNothingTokenizer</span><span class="p">(),</span>
            <span class="n">vocab</span><span class="o">=</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span>
            <span class="n">max_seq_len</span><span class="o">=</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">max_seq_len</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">script_tensorizer_impl</span> <span class="o">=</span> <span class="n">tensorizer_impl</span><span class="o">.</span><span class="n">torchscriptify</span><span class="p">()</span>
        <span class="n">per_sentence_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">tensorizer</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span>
        <span class="n">tokens_2d</span><span class="p">,</span> <span class="n">segment_labels_2d</span><span class="p">,</span> <span class="n">seq_lens_1d</span><span class="p">,</span> <span class="n">positions_2d</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="o">*</span><span class="p">[</span><span class="n">script_tensorizer_impl</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">per_sentence_tokens</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="n">script_tensors</span> <span class="o">=</span> <span class="n">script_tensorizer_impl</span><span class="o">.</span><span class="n">tensorize</span><span class="p">(</span>
            <span class="n">tokens_2d</span><span class="p">,</span> <span class="n">segment_labels_2d</span><span class="p">,</span> <span class="n">seq_lens_1d</span><span class="p">,</span> <span class="n">positions_2d</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">tensor</span><span class="p">,</span> <span class="n">expect</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">script_tensors</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tensor</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">expect</span><span class="p">)</span>
        <span class="c1"># test it is able to call torchscriptify multiple time</span>
        <span class="n">tensorizer_impl</span><span class="o">.</span><span class="n">torchscriptify</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="SquadForRobertaTensorizerTest"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.SquadForRobertaTensorizerTest">[docs]</a><span class="k">class</span> <span class="nc">SquadForRobertaTensorizerTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="SquadForRobertaTensorizerTest.test_squad_roberta_tensorizer"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.SquadForRobertaTensorizerTest.test_squad_roberta_tensorizer">[docs]</a>    <span class="k">def</span> <span class="nf">test_squad_roberta_tensorizer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">"doc"</span><span class="p">:</span> <span class="s2">"Prototype"</span><span class="p">,</span>
            <span class="s2">"question"</span><span class="p">:</span> <span class="s2">"otype"</span><span class="p">,</span>
            <span class="s2">"answers"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Prot"</span><span class="p">],</span>
            <span class="s2">"answer_starts"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">"has_answer"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">SquadForRoBERTaTensorizer</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
            <span class="n">SquadForRoBERTaTensorizer</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                <span class="n">tokenizer</span><span class="o">=</span><span class="n">GPT2BPETokenizer</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                    <span class="n">bpe_encoder_path</span><span class="o">=</span><span class="s2">"pytext/data/test/data/gpt2_encoder.json"</span><span class="p">,</span>
                    <span class="n">bpe_vocab_path</span><span class="o">=</span><span class="s2">"pytext/data/test/data/gpt2_vocab.bpe"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">vocab_file</span><span class="o">=</span><span class="s2">"pytext/data/test/data/gpt2_dict.txt"</span><span class="p">,</span>
                <span class="n">max_seq_len</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">tokens</span><span class="p">,</span> <span class="n">segments</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="c1"># check against manually verified answer positions in tokenized output</span>
        <span class="c1"># there are 4 identical answers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">),</span> <span class="n">seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">),</span> <span class="n">seq_len</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SquadForBERTTensorizerTest"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.SquadForBERTTensorizerTest">[docs]</a><span class="k">class</span> <span class="nc">SquadForBERTTensorizerTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="SquadForBERTTensorizerTest.test_squad_tensorizer"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.SquadForBERTTensorizerTest.test_squad_tensorizer">[docs]</a>    <span class="k">def</span> <span class="nf">test_squad_tensorizer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">SquadDataSource</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
            <span class="n">SquadDataSource</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                <span class="n">eval_filename</span><span class="o">=</span><span class="n">tests_module</span><span class="o">.</span><span class="n">test_file</span><span class="p">(</span><span class="s2">"squad_tiny.json"</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">eval</span><span class="p">))</span>
        <span class="n">tensorizer</span> <span class="o">=</span> <span class="n">SquadForBERTTensorizer</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
            <span class="n">SquadForBERTTensorizer</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                <span class="n">tokenizer</span><span class="o">=</span><span class="n">WordPieceTokenizer</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                    <span class="n">wordpiece_vocab_path</span><span class="o">=</span><span class="s2">"pytext/data/test/data/wordpiece_1k.txt"</span>
                <span class="p">),</span>
                <span class="n">max_seq_len</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">tokens</span><span class="p">,</span> <span class="n">segments</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="c1"># check against manually verified answer positions in tokenized output</span>
        <span class="c1"># there are 4 identical answers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="p">[</span><span class="mi">83</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">83</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="p">[</span><span class="mi">87</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">87</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">),</span> <span class="n">seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">),</span> <span class="n">seq_len</span><span class="p">)</span>

        <span class="n">tensorizer</span><span class="o">.</span><span class="n">max_seq_len</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="c1"># answer should be truncated out</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">tensorizer</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">),</span> <span class="n">seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">),</span> <span class="n">seq_len</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SquadTensorizerTest"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.SquadTensorizerTest">[docs]</a><span class="k">class</span> <span class="nc">SquadTensorizerTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="SquadTensorizerTest.setUp"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.SquadTensorizerTest.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">json_data_source</span> <span class="o">=</span> <span class="n">SquadDataSource</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
            <span class="n">SquadDataSource</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                <span class="n">train_filename</span><span class="o">=</span><span class="n">tests_module</span><span class="o">.</span><span class="n">test_file</span><span class="p">(</span><span class="s2">"squad_tiny.json"</span><span class="p">),</span>
                <span class="n">eval_filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">test_filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tsv_data_source</span> <span class="o">=</span> <span class="n">SquadDataSource</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
            <span class="n">SquadDataSource</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                <span class="n">train_filename</span><span class="o">=</span><span class="n">tests_module</span><span class="o">.</span><span class="n">test_file</span><span class="p">(</span><span class="s2">"squad_tiny.tsv"</span><span class="p">),</span>
                <span class="n">eval_filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">test_filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_wordpiece</span> <span class="o">=</span> <span class="n">SquadTensorizer</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
            <span class="n">SquadTensorizer</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                <span class="n">tokenizer</span><span class="o">=</span><span class="n">WordPieceTokenizer</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                    <span class="n">wordpiece_vocab_path</span><span class="o">=</span><span class="s2">"pytext/data/test/data/wordpiece_1k.txt"</span>
                <span class="p">),</span>
                <span class="n">max_seq_len</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_alphanumeric</span> <span class="o">=</span> <span class="n">SquadTensorizer</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
            <span class="n">SquadTensorizer</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span>
                <span class="n">tokenizer</span><span class="o">=</span><span class="n">Tokenizer</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">split_regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">"\W+"</span><span class="p">),</span> <span class="n">max_seq_len</span><span class="o">=</span><span class="mi">250</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_init_tensorizer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsv</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">tensorizer_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"wordpiece"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_wordpiece</span><span class="p">,</span>
            <span class="s2">"alphanumeric"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_alphanumeric</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">data_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsv_data_source</span><span class="o">.</span><span class="n">train</span> <span class="k">if</span> <span class="n">tsv</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_data_source</span><span class="o">.</span><span class="n">train</span>
        <span class="n">initialize_tensorizers</span><span class="p">(</span><span class="n">tensorizer_dict</span><span class="p">,</span> <span class="n">data_source</span><span class="p">)</span>

<div class="viewcode-block" id="SquadTensorizerTest.test_initialize"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.SquadTensorizerTest.test_initialize">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_tensorizer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_wordpiece</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_wordpiece</span><span class="o">.</span><span class="n">ques_tensorizer</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span> <span class="mi">1000</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_wordpiece</span><span class="o">.</span><span class="n">doc_tensorizer</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_alphanumeric</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span> <span class="mi">1418</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_alphanumeric</span><span class="o">.</span><span class="n">ques_tensorizer</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span> <span class="mi">1418</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_alphanumeric</span><span class="o">.</span><span class="n">doc_tensorizer</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span> <span class="mi">1418</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="SquadTensorizerTest.test_numberize_with_alphanumeric"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.SquadTensorizerTest.test_numberize_with_alphanumeric">[docs]</a>    <span class="k">def</span> <span class="nf">test_numberize_with_alphanumeric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_tensorizer</span><span class="p">()</span>
        <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_data_source</span><span class="o">.</span><span class="n">train</span><span class="p">))</span>
        <span class="p">(</span>
            <span class="n">doc_tokens</span><span class="p">,</span>
            <span class="n">doc_seq_len</span><span class="p">,</span>
            <span class="n">ques_tokens</span><span class="p">,</span>
            <span class="n">ques_seq_len</span><span class="p">,</span>
            <span class="n">answer_start_token_idx</span><span class="p">,</span>
            <span class="n">answer_end_token_idx</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_alphanumeric</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="c1"># check against manually verified answer positions in tokenized output</span>
        <span class="c1"># there are 4 identical answers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ques_tokens</span><span class="p">),</span> <span class="n">ques_seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">doc_tokens</span><span class="p">),</span> <span class="n">doc_seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ques_tokens</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>  <span class="c1"># It's a coincidence.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">answer_start_token_idx</span><span class="p">,</span> <span class="p">[</span><span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">answer_end_token_idx</span><span class="p">,</span> <span class="p">[</span><span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_alphanumeric</span><span class="o">.</span><span class="n">doc_tensorizer</span><span class="o">.</span><span class="n">max_seq_len</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="c1"># answer should be truncated out because max doc len is smaller.</span>
        <span class="p">(</span>
            <span class="n">doc_tokens</span><span class="p">,</span>
            <span class="n">doc_seq_len</span><span class="p">,</span>
            <span class="n">ques_tokens</span><span class="p">,</span>
            <span class="n">ques_seq_len</span><span class="p">,</span>
            <span class="n">answer_start_token_idx</span><span class="p">,</span>
            <span class="n">answer_end_token_idx</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_alphanumeric</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ques_tokens</span><span class="p">),</span> <span class="n">ques_seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">doc_tokens</span><span class="p">),</span> <span class="n">doc_seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">answer_start_token_idx</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">answer_end_token_idx</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">])</span></div>

<div class="viewcode-block" id="SquadTensorizerTest.test_numberize_with_wordpiece"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.SquadTensorizerTest.test_numberize_with_wordpiece">[docs]</a>    <span class="k">def</span> <span class="nf">test_numberize_with_wordpiece</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_tensorizer</span><span class="p">()</span>
        <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_data_source</span><span class="o">.</span><span class="n">train</span><span class="p">))</span>
        <span class="p">(</span>
            <span class="n">doc_tokens</span><span class="p">,</span>
            <span class="n">doc_seq_len</span><span class="p">,</span>
            <span class="n">ques_tokens</span><span class="p">,</span>
            <span class="n">ques_seq_len</span><span class="p">,</span>
            <span class="n">answer_start_token_idx</span><span class="p">,</span>
            <span class="n">answer_end_token_idx</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_wordpiece</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="c1"># check against manually verified answer positions in tokenized output</span>
        <span class="c1"># there are 4 identical answers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ques_tokens</span><span class="p">),</span> <span class="n">ques_seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">doc_tokens</span><span class="p">),</span> <span class="n">doc_seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">answer_start_token_idx</span><span class="p">,</span> <span class="p">[</span><span class="mi">70</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">70</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">answer_end_token_idx</span><span class="p">,</span> <span class="p">[</span><span class="mi">74</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">74</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_wordpiece</span><span class="o">.</span><span class="n">doc_tensorizer</span><span class="o">.</span><span class="n">max_seq_len</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="c1"># answer should be truncated out because max doc len is smaller.</span>
        <span class="p">(</span>
            <span class="n">doc_tokens</span><span class="p">,</span>
            <span class="n">doc_seq_len</span><span class="p">,</span>
            <span class="n">ques_tokens</span><span class="p">,</span>
            <span class="n">ques_seq_len</span><span class="p">,</span>
            <span class="n">answer_start_token_idx</span><span class="p">,</span>
            <span class="n">answer_end_token_idx</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_wordpiece</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ques_tokens</span><span class="p">),</span> <span class="n">ques_seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">doc_tokens</span><span class="p">),</span> <span class="n">doc_seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">answer_start_token_idx</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">answer_end_token_idx</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">])</span></div>

<div class="viewcode-block" id="SquadTensorizerTest.test_tsv_numberize_with_alphanumeric"><a class="viewcode-back" href="../../../../modules/pytext.data.test.html#pytext.data.test.tensorizers_test.SquadTensorizerTest.test_tsv_numberize_with_alphanumeric">[docs]</a>    <span class="k">def</span> <span class="nf">test_tsv_numberize_with_alphanumeric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># No need to repeat other tests with TSV.</span>
        <span class="c1"># All we want to test is that TSV and JSON loading are identical.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_tensorizer</span><span class="p">(</span><span class="n">tsv</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_data_source</span><span class="o">.</span><span class="n">train</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="p">(</span>
            <span class="n">doc_tokens</span><span class="p">,</span>
            <span class="n">doc_seq_len</span><span class="p">,</span>
            <span class="n">ques_tokens</span><span class="p">,</span>
            <span class="n">ques_seq_len</span><span class="p">,</span>
            <span class="n">answer_start_token_idx</span><span class="p">,</span>
            <span class="n">answer_end_token_idx</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_alphanumeric</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="c1"># check against manually verified answer positions in tokenized output</span>
        <span class="c1"># there are 4 identical answers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ques_tokens</span><span class="p">),</span> <span class="n">ques_seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">doc_tokens</span><span class="p">),</span> <span class="n">doc_seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ques_tokens</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>  <span class="c1"># It's a coincidence.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">answer_start_token_idx</span><span class="p">,</span> <span class="p">[</span><span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">answer_end_token_idx</span><span class="p">,</span> <span class="p">[</span><span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_alphanumeric</span><span class="o">.</span><span class="n">doc_tensorizer</span><span class="o">.</span><span class="n">max_seq_len</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="c1"># answer should be truncated out because max doc len is smaller.</span>
        <span class="p">(</span>
            <span class="n">doc_tokens</span><span class="p">,</span>
            <span class="n">doc_seq_len</span><span class="p">,</span>
            <span class="n">ques_tokens</span><span class="p">,</span>
            <span class="n">ques_seq_len</span><span class="p">,</span>
            <span class="n">answer_start_token_idx</span><span class="p">,</span>
            <span class="n">answer_end_token_idx</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorizer_with_alphanumeric</span><span class="o">.</span><span class="n">numberize</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ques_tokens</span><span class="p">),</span> <span class="n">ques_seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">doc_tokens</span><span class="p">),</span> <span class="n">doc_seq_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">answer_start_token_idx</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">answer_end_token_idx</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">])</span></div></div>
</pre></div>
</div>
</div>
</div>
<div aria-label="main navigation" class="sphinxsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">PyText</a></h1>
<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../train_your_first_model.html">Train your first model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../execute_your_first_model.html">Execute your first model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../visualize_your_model.html">Visualize Model Training with TensorBoard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pytext_models_in_your_app.html">Use PyText models in your app</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../serving_models_in_production.html">Serve Models in Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../config_files.html">Config Files Explained</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../config_commands.html">Config Commands</a></li>
</ul>
<p class="caption"><span class="caption-text">Training More Advanced Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../atis_tutorial.html">Train Intent-Slot model on ATIS Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hierarchical_intent_slot_tutorial.html">Hierarchical intent and slot filling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../disjoint_multitask_tutorial.html">Multitask training with disjoint datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed_training_tutorial.html">Data Parallel Distributed Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../xlm_r.html">XLM-RoBERTa</a></li>
</ul>
<p class="caption"><span class="caption-text">Extending PyText</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../overview.html">Architecture Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../datasource_tutorial.html">Custom Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tensorizer.html">Custom Tensorizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dense.html">Using External Dense Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../create_new_model.html">Creating A New Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hacking_pytext.html">Hacking PyText</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../configs/pytext.html">pytext</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules/pytext.html">pytext package</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
<li><a href="../../../../index.html">Documentation overview</a><ul>
<li><a href="../../../index.html">Module code</a><ul>
<li><a href="../../../pytext.html">pytext</a><ul>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>
<div id="searchbox" role="search" style="display: none">
<h3 id="searchlabel">Quick search</h3>
<div class="searchformwrapper">
<form action="../../../../search.html" class="search" method="get">
<input aria-labelledby="searchlabel" name="q" type="text"/>
<input type="submit" value="Go"/>
</form>
</div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>
</div>
<div class="clearer"></div>
</div></div>